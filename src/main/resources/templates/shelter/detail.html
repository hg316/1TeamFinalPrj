
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Insert title here</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
</head>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<!-- 헤더링크 -->
<th:block th:replace="~{fragments/header_link :: header_link}" />

<body>
  <!-- Header Section Begin -->
  <th:block th:replace="~{fragments/header :: header}" />
  <!-- Header End -->
  <div class="container">
    <form id="form1" class="form-horizontal">
        <h2>보호소 정보</h2>
        <!-- 보호소 관심 버튼 -->
		<div class="form-group row">
				<div class="col-sm-12">
					<th:block th:if="${session.member != null}"
						th:with="member_idx=${session.member.member_idx}">
						<button type="button" class="btn btn-primary btn-block"
							th:onclick="'registInterestShelter(' + ${detail.shelter_idx} + ', ' + ${member_idx} + ')'">관심
							등록</button>
					</th:block>
				</div>
		</div>
        <!-- 보호소 정보 -->
        <input type="hidden" th:value="${detail.lat}" id="shelterLat">
        <input type="hidden" th:value="${detail.lng}" id="shelterLng">
        <div class="form-group row">
            <div class="col-6">
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">동물보호센터명</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.careNm}" id="shelterNm" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">동물보호센터유형</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.divisionNm}" id="shelterDivisionNm" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">동물보호센터지정일</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.dsignationDate}" id="shelterDsignationDate" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">평일운영시작시각</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.weekOprStime}" id="shelterWeekOprStime" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">전화번호</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.careTel}" id="shelterCareTel" readonly>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">관리기관명</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.orgNm}" id="shelterOrgNm"  readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">소재지도로명주소</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.careAddr}" id="shelterCareAddr" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">휴무일</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.closeDay}" id="shelterCloseDay" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">평일운영종료시각</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.weekOprEtime}" id="shelterWeekOprEtime" readonly>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="date_time" class="col-sm-12 col-form-label">보호소 정보 업데이트 날짜</label>
                    <div class="col-sm-12">
                        <input type="text" class="form-control" th:value="${detail.dataStdDt}" id="shelterDataStdDt" readonly>
                    </div>
                </div>
            </div>
            <div class="col-12">
            	<button type="button" id="bt_search_animal" class="btn btn-secondary col-12" style="margin: 0 auto;">해당 보호소에 있는 동물 조회</button>
            </div>
        </div>
        <div id="map" style="width: 100%;height: 700px;"></div>
        <br>
    </form>
</div>
</body>
</html>
<script th:inline="javascript">
	function registInterestShelter(shelter_idx,member_idx){
		
		$.ajax({
			url : '/shelter/registInterestShelter',
			type:"POST",
			data : {
				shelter_idx : shelter_idx,
				member_idx : member_idx
			},
			success : function(response){
				alert("관심 보호소 등록 완료");
			},
			error:function(error){
				alert("관심 보호소 등록 실패");
			}
		});
	}
	
	function getShelterList(careNm){
		$.ajax({
			url : '/rest/shelter',
			type:"GET",
			data:{
				care_nm : careNm
			},
			success:function(response){
				console.log(response);
			},
			error : function(xhr,status,error){
				console.error('Error',status,error);
			}
		});
	}
	
  function list(){
    $("#form1").attr({
      action:"/volunteer/list",
      method:"get"
    });
    $("#form1").submit();
  }

  
  function initMap() {
      window.addEventListener('DOMContentLoaded', (event) => {
          const shelterLat = parseFloat(document.getElementById('shelterLat').value);
          const shelterLng = parseFloat(document.getElementById('shelterLng').value);
          const shelterNm = document.getElementById('shelterNm').value;
          console.log("shelterLat: " + shelterLat);
          console.log("shelterLng: " + shelterLng);
          
          
          if(shelterLat == 0 && shelterLng == 0){
        	// 유효한 값이 없는 경우 "정보가 없습니다" 메시지 표시
              const infoWindow = new google.maps.InfoWindow({
                  content: '정보가 없습니다',
                  position: center
              });
              infoWindow.open(map);
          }
          
          const mapDiv = document.getElementById('map');
          const center = { lat: shelterLat, lng: shelterLng };
          const map = new google.maps.Map(mapDiv, {
              center: center,
              zoom: 15
          });

          // 마커 추가 예시
          const marker = new google.maps.Marker({
              position: center,
              map: map,
              title: shelterNm
          });
          
          const infoWindow = new google.maps.InfoWindow({
              content: shelterNm
          });
          
          marker.addListener('click', function() {
              infoWindow.open(map, marker);
          });
      });
  }

  $(function(){
    $("#bt_list").click(function(){
      list();      
    });    
  });
  //유기동물list 페이지로 redirect
	$(function() {
		$("#bt_search_animal").click(function() {
			const care = $("#shelterNm").val(); //관할기관
			care = care.replace(/\([^)]*\)/g, ''); //괄호와 내부 내용 제거
			location.href = "/animal/list?care=" + encodeURIComponent(care);
		});
	});
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8rEH-63KAr-Tl0v-dzo5BkS6BYvZoaD4&callback=initMap"></script>